openapi: 3.0.3
info:
  title: YURUBO API - Phase 1 Event Creation
  description: |
    ãƒ•ã‚§ãƒ¼ã‚º1ï¼šã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæ©Ÿèƒ½ã®APIä»•æ§˜

    **Feature Branch**: `001-event-creation`

    ã“ã®APIã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™:
    - ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆï¼ˆåŒ¿åæŠ•ç¨¿ï¼‰
    - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å–å¾—ï¼ˆã¤ãªãŒã‚Šãƒªã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ï¼‰
    - ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°å–å¾—
    - ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†ï¼ˆå‚åŠ è€…æ‰¿èªå‰ã®ã¿ï¼‰
    - ã‚¤ãƒ™ãƒ³ãƒˆä¸­æ­¢

    ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯Supabase RLSã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚
  version: 1.0.0
  contact:
    name: YURUBO Development Team

servers:
  - url: https://your-project.supabase.co/rest/v1
    description: Supabase REST API (Production)
  - url: http://localhost:54321/rest/v1
    description: Supabase Local Development

security:
  - BearerAuth: []

tags:
  - name: events
    description: ã‚¤ãƒ™ãƒ³ãƒˆæ“ä½œï¼ˆä½œæˆã€å–å¾—ã€ç·¨é›†ã€ä¸­æ­¢ï¼‰

paths:
  /events:
    post:
      tags:
        - events
      summary: ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
      description: |
        æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼ˆåŒ¿åæŠ•ç¨¿ï¼‰ã€‚

        **æ©Ÿèƒ½è¦ä»¶**: FR-001, FR-002, FR-003, FR-004, FR-005, FR-006, FR-007, FR-008, FR-009

        **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**:
        - ã‚«ãƒ†ã‚´ãƒªã¨é–‹å‚¬æ—¥æ™‚ã¯å¿…é ˆ
        - é–‹å‚¬æ—¥æ™‚ï¼ˆé–‹å§‹ï¼‰ã¯ç¾åœ¨ã‚ˆã‚Šæœªæ¥
        - é–‹å‚¬æ—¥æ™‚ï¼ˆçµ‚äº†ï¼‰ã¯é–‹å§‹ã‚ˆã‚Šå¾Œ
        - æƒ³å®šäººæ•°ã®æœ€å°å€¤ â‰¤ æœ€å¤§å€¤
        - å—ä»˜ç· åˆ‡æ—¥æ™‚ < é–‹å‚¬æ—¥æ™‚ï¼ˆé–‹å§‹ï¼‰
        - åŒä¸€ã‚«ãƒ†ã‚´ãƒªã®æŠ•ç¨¿ã¯1æ—¥3ä»¶ã¾ã§

        **å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
        1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        2. 1æ—¥ã®æŠ•ç¨¿ä¸Šé™ãƒã‚§ãƒƒã‚¯ï¼ˆåŒä¸€ã‚«ãƒ†ã‚´ãƒª3ä»¶ã¾ã§ï¼‰
        3. åŒ¿åIDç”Ÿæˆï¼ˆã‚«ãƒ†ã‚´ãƒªçµµæ–‡å­— + é€£ç•ªã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆï¼‰
        4. ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ï¼ˆstatus: recruitingï¼‰
        5. æŠ•ç¨¿è€…ã‚’ä»®å¹¹äº‹ã¨ã—ã¦ç™»éŒ²
        6. ã¤ãªãŒã‚Šãƒªã‚¹ãƒˆå†…ã®è©²å½“ã‚«ãƒ†ã‚´ãƒªOKãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é…ä¿¡
      operationId: createEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEventRequest'
            examples:
              drinking_event:
                summary: é£²ã¿ã‚¤ãƒ™ãƒ³ãƒˆ
                value:
                  category: drinking
                  date_start: "2025-11-15T19:00:00+09:00"
                  date_end: "2025-11-15T22:00:00+09:00"
                  capacity_min: 3
                  capacity_max: 5
                  price_min: 3000
                  price_max: 5000
                  comment: "ä»•äº‹çµ‚ã‚ã‚Šã«è»½ãä¸€æ¯ã©ã†ã§ã™ã‹?"
              travel_event:
                summary: æ—…è¡Œã‚¤ãƒ™ãƒ³ãƒˆ
                value:
                  category: travel
                  date_start: "2025-12-01T09:00:00+09:00"
                  date_end: "2025-12-03T18:00:00+09:00"
                  capacity_min: 4
                  capacity_max: 8
                  price_min: 20000
                  price_max: 30000
                  deadline: "2025-11-25T23:59:59+09:00"
                  comment: "æ¸©æ³‰æ—…è¡Œã«è¡Œãã¾ã›ã‚“ã‹?"
      responses:
        '201':
          description: ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ•ç¨¿ã—ã¾ã—ãŸ"
                code: "EVENT_CREATED"
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  anon_id: "ğŸ¶A"
                  category: "drinking"
                  date_start: "2025-11-15T19:00:00+09:00"
                  date_end: "2025-11-15T22:00:00+09:00"
                  capacity_min: 3
                  capacity_max: 5
                  price_min: 3000
                  price_max: 5000
                  comment: "ä»•äº‹çµ‚ã‚ã‚Šã«è»½ãä¸€æ¯ã©ã†ã§ã™ã‹?"
                  status: "recruiting"
                  created_at: "2025-11-11T10:00:00+09:00"
        '400':
          description: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_required:
                  summary: å¿…é ˆé …ç›®æœªå…¥åŠ›
                  value:
                    success: false
                    message: "ã‚«ãƒ†ã‚´ãƒªã¨é–‹å‚¬æ—¥æ™‚ã¯å¿…é ˆã§ã™"
                    code: "VALIDATION_ERROR"
                past_date:
                  summary: éå»ã®æ—¥æ™‚
                  value:
                    success: false
                    message: "é–‹å‚¬æ—¥æ™‚ã¯ç¾åœ¨ã‚ˆã‚Šæœªæ¥ã®æ—¥æ™‚ã‚’æŒ‡å®šã—ã¦ãã ã•ã„"
                    code: "VALIDATION_ERROR"
                invalid_date_range:
                  summary: æ—¥æ™‚ã®å‰å¾Œé–¢ä¿‚ã‚¨ãƒ©ãƒ¼
                  value:
                    success: false
                    message: "çµ‚äº†æ™‚åˆ»ã¯é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šå¾Œã«è¨­å®šã—ã¦ãã ã•ã„"
                    code: "VALIDATION_ERROR"
                invalid_capacity:
                  summary: äººæ•°ã®å‰å¾Œé–¢ä¿‚ã‚¨ãƒ©ãƒ¼
                  value:
                    success: false
                    message: "æœ€å°äººæ•°ã¯æœ€å¤§äººæ•°ä»¥ä¸‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™"
                    code: "VALIDATION_ERROR"
                invalid_deadline:
                  summary: å—ä»˜ç· åˆ‡ã‚¨ãƒ©ãƒ¼
                  value:
                    success: false
                    message: "å—ä»˜ç· åˆ‡ã¯é–‹å‚¬é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šå‰ã«è¨­å®šã—ã¦ãã ã•ã„"
                    code: "VALIDATION_ERROR"
        '429':
          description: æŠ•ç¨¿ä¸Šé™ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "1æ—¥ã®æŠ•ç¨¿ä¸Šé™ï¼ˆ3ä»¶ï¼‰ã«é”ã—ã¾ã—ãŸ"
                code: "DAILY_LIMIT_EXCEEDED"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags:
        - events
      summary: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å–å¾—ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ï¼‰
      description: |
        ã¤ãªãŒã‚Šãƒªã‚¹ãƒˆå†…ã®è©²å½“ã‚«ãƒ†ã‚´ãƒªOKã®ã‚¤ãƒ™ãƒ³ãƒˆæŠ•ç¨¿ã‚’å–å¾—ã—ã¾ã™ã€‚

        **æ©Ÿèƒ½è¦ä»¶**: FR-010, FR-011, FR-012

        **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ«**ï¼ˆRLSãƒãƒªã‚·ãƒ¼ã§è‡ªå‹•é©ç”¨ï¼‰:
        - è‡ªåˆ†ã®æŠ•ç¨¿ã¯å¸¸ã«è¡¨ç¤º
        - ã¤ãªãŒã‚Šãƒªã‚¹ãƒˆå†…ã§è©²å½“ã‚«ãƒ†ã‚´ãƒªOKã®æŠ•ç¨¿ã®ã¿è¡¨ç¤º
        - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ`recruiting`ã®ã¿è¡¨ç¤ºï¼ˆå‹Ÿé›†ä¸­ï¼‰

        **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**:
        - Cursor-based paginationï¼ˆrangeæ–¹å¼ï¼‰
        - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ20ä»¶ãšã¤å–å¾—
        - ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ
      operationId: getEventTimeline
      parameters:
        - name: offset
          in: query
          description: å–å¾—é–‹å§‹ä½ç½®ï¼ˆ0ã‹ã‚‰é–‹å§‹ï¼‰
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: limit
          in: query
          description: å–å¾—ä»¶æ•°ï¼ˆæœ€å¤§100ä»¶ï¼‰
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: category
          in: query
          description: ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ï¼ˆä»»æ„ï¼‰
          required: false
          schema:
            type: string
            enum:
              - drinking
              - travel
              - tennis
              - other
      responses:
        '200':
          description: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’å–å¾—ã—ã¾ã—ãŸ"
                  code:
                    type: string
                    example: "TIMELINE_FETCHED"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Event'
                  pagination:
                    type: object
                    properties:
                      offset:
                        type: integer
                        example: 0
                      limit:
                        type: integer
                        example: 20
                      total:
                        type: integer
                        example: 50
                      has_more:
                        type: boolean
                        example: true
              example:
                success: true
                message: "ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’å–å¾—ã—ã¾ã—ãŸ"
                code: "TIMELINE_FETCHED"
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    anon_id: "ğŸ¶A"
                    category: "drinking"
                    date_start: "2025-11-15T19:00:00+09:00"
                    date_end: "2025-11-15T22:00:00+09:00"
                    capacity_min: 3
                    capacity_max: 5
                    price_min: 3000
                    price_max: 5000
                    comment: "ä»•äº‹çµ‚ã‚ã‚Šã«è»½ãä¸€æ¯ã©ã†ã§ã™ã‹?"
                    status: "recruiting"
                    created_at: "2025-11-11T10:00:00+09:00"
                pagination:
                  offset: 0
                  limit: 20
                  total: 50
                  has_more: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /events/{event_id}:
    get:
      tags:
        - events
      summary: ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°å–å¾—
      description: |
        ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆã®è©³ç´°æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

        **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**ï¼ˆRLSãƒãƒªã‚·ãƒ¼ã§è‡ªå‹•é©ç”¨ï¼‰:
        - è‡ªåˆ†ã®æŠ•ç¨¿ã¯å¸¸ã«é–²è¦§å¯
        - ã¤ãªãŒã‚Šãƒªã‚¹ãƒˆå†…ã§è©²å½“ã‚«ãƒ†ã‚´ãƒªOKã®æŠ•ç¨¿ã®ã¿é–²è¦§å¯
      operationId: getEventById
      parameters:
        - name: event_id
          in: path
          description: ã‚¤ãƒ™ãƒ³ãƒˆIDï¼ˆUUIDï¼‰
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã‚’å–å¾—ã—ã¾ã—ãŸ"
                  code:
                    type: string
                    example: "EVENT_FETCHED"
                  data:
                    $ref: '#/components/schemas/Event'
        '404':
          description: ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ã¾ãŸã¯ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãªã—
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
                code: "EVENT_NOT_FOUND"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    patch:
      tags:
        - events
      summary: ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†
      description: |
        ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã‚’ç·¨é›†ã—ã¾ã™ã€‚

        **æ©Ÿèƒ½è¦ä»¶**: FR-013, FR-014

        **ç·¨é›†æ¡ä»¶**:
        - æŠ•ç¨¿è€…æœ¬äººã®ã¿ç·¨é›†å¯èƒ½
        - å‚åŠ è€…æ‰¿èªå‰ï¼ˆstatus: recruitingï¼‰ã®ã¿ç·¨é›†å¯èƒ½
        - å‚åŠ è€…ãŒæ‰¿èªã•ã‚ŒãŸå¾Œã¯ç·¨é›†ä¸å¯

        **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**:
        - ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæ™‚ã¨åŒã˜ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨
      operationId: updateEvent
      parameters:
        - name: event_id
          in: path
          description: ã‚¤ãƒ™ãƒ³ãƒˆIDï¼ˆUUIDï¼‰
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEventRequest'
            example:
              date_start: "2025-11-16T20:00:00+09:00"
              date_end: "2025-11-16T23:00:00+09:00"
              comment: "æ—¥æ™‚ã‚’å¤‰æ›´ã—ã¾ã—ãŸï¼"
      responses:
        '200':
          description: ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸ"
                code: "EVENT_UPDATED"
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  anon_id: "ğŸ¶A"
                  category: "drinking"
                  date_start: "2025-11-16T20:00:00+09:00"
                  date_end: "2025-11-16T23:00:00+09:00"
                  capacity_min: 3
                  capacity_max: 5
                  price_min: 3000
                  price_max: 5000
                  comment: "æ—¥æ™‚ã‚’å¤‰æ›´ã—ã¾ã—ãŸï¼"
                  status: "recruiting"
                  updated_at: "2025-11-11T12:00:00+09:00"
        '400':
          description: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "çµ‚äº†æ™‚åˆ»ã¯é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šå¾Œã«è¨­å®šã—ã¦ãã ã•ã„"
                code: "VALIDATION_ERROR"
        '403':
          description: ç·¨é›†æ¨©é™ãªã—ï¼ˆå‚åŠ è€…æ‰¿èªæ¸ˆã¿ï¼‰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "å‚åŠ è€…ç¢ºå®šå¾Œã¯ç·¨é›†ã§ãã¾ã›ã‚“"
                code: "FORBIDDEN"
        '404':
          description: ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
                code: "EVENT_NOT_FOUND"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - events
      summary: ã‚¤ãƒ™ãƒ³ãƒˆä¸­æ­¢
      description: |
        ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¸­æ­¢ã—ã¾ã™ï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‹ã‚‰éè¡¨ç¤ºã€å‚åŠ è€…ã«é€šçŸ¥ï¼‰ã€‚

        **æ©Ÿèƒ½è¦ä»¶**: FR-020

        **å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
        1. ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’`cancelled`ã«å¤‰æ›´
        2. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‹ã‚‰éè¡¨ç¤º
        3. å‚åŠ è€…å…¨å“¡ã«ä¸­æ­¢é€šçŸ¥ã‚’é€ä¿¡ï¼ˆãƒ•ã‚§ãƒ¼ã‚º2ä»¥é™ã§å®Ÿè£…ï¼‰

        **ä¸­æ­¢æ¡ä»¶**:
        - æŠ•ç¨¿è€…ï¼ˆå¹¹äº‹ï¼‰æœ¬äººã®ã¿ä¸­æ­¢å¯èƒ½
        - ã„ãšã‚Œã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‹ã‚‰ã§ã‚‚ä¸­æ­¢å¯èƒ½
      operationId: cancelEvent
      parameters:
        - name: event_id
          in: path
          description: ã‚¤ãƒ™ãƒ³ãƒˆIDï¼ˆUUIDï¼‰
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ã‚¤ãƒ™ãƒ³ãƒˆä¸­æ­¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¸­æ­¢ã—ã¾ã—ãŸ"
                code: "EVENT_CANCELLED"
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  status: "cancelled"
        '404':
          description: ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
                code: "EVENT_NOT_FOUND"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Supabase JWT Tokenï¼ˆ`auth.users`ã‹ã‚‰å–å¾—ï¼‰

  schemas:
    CreateEventRequest:
      type: object
      required:
        - category
        - date_start
        - date_end
        - capacity_min
        - capacity_max
      properties:
        category:
          type: string
          enum:
            - drinking
            - travel
            - tennis
            - other
          description: ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ†ã‚´ãƒªï¼ˆå¿…é ˆï¼‰
        date_start:
          type: string
          format: date-time
          description: é–‹å‚¬é–‹å§‹æ—¥æ™‚ï¼ˆå¿…é ˆã€ISO 8601å½¢å¼ã€ç¾åœ¨ã‚ˆã‚Šæœªæ¥ï¼‰
        date_end:
          type: string
          format: date-time
          description: é–‹å‚¬çµ‚äº†æ—¥æ™‚ï¼ˆå¿…é ˆã€ISO 8601å½¢å¼ã€é–‹å§‹ã‚ˆã‚Šå¾Œï¼‰
        deadline:
          type: string
          format: date-time
          description: å—ä»˜ç· åˆ‡æ—¥æ™‚ï¼ˆä»»æ„ã€ISO 8601å½¢å¼ã€é–‹å§‹ã‚ˆã‚Šå‰ï¼‰
        capacity_min:
          type: integer
          minimum: 1
          description: æƒ³å®šæœ€å°äººæ•°ï¼ˆå¿…é ˆã€1äººä»¥ä¸Šï¼‰
        capacity_max:
          type: integer
          minimum: 1
          description: æƒ³å®šæœ€å¤§äººæ•°ï¼ˆå¿…é ˆã€æœ€å°äººæ•°ä»¥ä¸Šï¼‰
        price_min:
          type: integer
          minimum: 0
          description: ä¾¡æ ¼å¸¯æœ€å°å€¤ï¼ˆä»»æ„ã€0å††ä»¥ä¸Šï¼‰
        price_max:
          type: integer
          minimum: 0
          description: ä¾¡æ ¼å¸¯æœ€å¤§å€¤ï¼ˆä»»æ„ã€æœ€å°å€¤ä»¥ä¸Šï¼‰
        comment:
          type: string
          maxLength: 500
          description: ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ã€500æ–‡å­—ä»¥å†…ï¼‰

    UpdateEventRequest:
      type: object
      properties:
        date_start:
          type: string
          format: date-time
          description: é–‹å‚¬é–‹å§‹æ—¥æ™‚ï¼ˆä»»æ„ã€ç¾åœ¨ã‚ˆã‚Šæœªæ¥ï¼‰
        date_end:
          type: string
          format: date-time
          description: é–‹å‚¬çµ‚äº†æ—¥æ™‚ï¼ˆä»»æ„ã€é–‹å§‹ã‚ˆã‚Šå¾Œï¼‰
        deadline:
          type: string
          format: date-time
          description: å—ä»˜ç· åˆ‡æ—¥æ™‚ï¼ˆä»»æ„ã€é–‹å§‹ã‚ˆã‚Šå‰ï¼‰
        capacity_min:
          type: integer
          minimum: 1
          description: æƒ³å®šæœ€å°äººæ•°ï¼ˆä»»æ„ã€1äººä»¥ä¸Šï¼‰
        capacity_max:
          type: integer
          minimum: 1
          description: æƒ³å®šæœ€å¤§äººæ•°ï¼ˆä»»æ„ã€æœ€å°äººæ•°ä»¥ä¸Šï¼‰
        price_min:
          type: integer
          minimum: 0
          description: ä¾¡æ ¼å¸¯æœ€å°å€¤ï¼ˆä»»æ„ã€0å††ä»¥ä¸Šï¼‰
        price_max:
          type: integer
          minimum: 0
          description: ä¾¡æ ¼å¸¯æœ€å¤§å€¤ï¼ˆä»»æ„ã€æœ€å°å€¤ä»¥ä¸Šï¼‰
        comment:
          type: string
          maxLength: 500
          description: ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ã€500æ–‡å­—ä»¥å†…ï¼‰

    Event:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: ã‚¤ãƒ™ãƒ³ãƒˆID
        anon_id:
          type: string
          description: åŒ¿åIDï¼ˆä¾‹: ğŸ¶Aï¼‰
        category:
          type: string
          enum:
            - drinking
            - travel
            - tennis
            - other
          description: ã‚«ãƒ†ã‚´ãƒª
        date_start:
          type: string
          format: date-time
          description: é–‹å‚¬é–‹å§‹æ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰
        date_end:
          type: string
          format: date-time
          description: é–‹å‚¬çµ‚äº†æ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰
        deadline:
          type: string
          format: date-time
          nullable: true
          description: å—ä»˜ç· åˆ‡æ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰
        capacity_min:
          type: integer
          description: æƒ³å®šæœ€å°äººæ•°
        capacity_max:
          type: integer
          description: æƒ³å®šæœ€å¤§äººæ•°
        price_min:
          type: integer
          nullable: true
          description: ä¾¡æ ¼å¸¯æœ€å°å€¤
        price_max:
          type: integer
          nullable: true
          description: ä¾¡æ ¼å¸¯æœ€å¤§å€¤
        comment:
          type: string
          nullable: true
          description: ã‚³ãƒ¡ãƒ³ãƒˆ
        status:
          type: string
          enum:
            - recruiting
            - confirmed
            - completed
            - cancelled
          description: ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        created_at:
          type: string
          format: date-time
          description: ä½œæˆæ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰
        updated_at:
          type: string
          format: date-time
          description: æ›´æ–°æ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰

    SuccessResponse:
      type: object
      required:
        - success
        - message
        - code
      properties:
        success:
          type: boolean
          example: true
          description: æˆåŠŸãƒ•ãƒ©ã‚°
        message:
          type: string
          description: æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ—¥æœ¬èªï¼‰
        code:
          type: string
          description: æˆåŠŸã‚³ãƒ¼ãƒ‰ï¼ˆå¤§æ–‡å­—ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ï¼‰
        data:
          type: object
          description: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ï¼ˆä»»æ„ï¼‰

    ErrorResponse:
      type: object
      required:
        - success
        - message
        - code
      properties:
        success:
          type: boolean
          example: false
          description: æˆåŠŸãƒ•ãƒ©ã‚°
        message:
          type: string
          description: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ—¥æœ¬èªï¼‰
        code:
          type: string
          description: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆå¤§æ–‡å­—ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ï¼‰

  responses:
    Unauthorized:
      description: èªè¨¼ã‚¨ãƒ©ãƒ¼ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æœªæä¾›ã¾ãŸã¯ç„¡åŠ¹ï¼‰
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "èªè¨¼ãŒå¿…è¦ã§ã™"
            code: "UNAUTHORIZED"

    InternalServerError:
      description: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„"
            code: "INTERNAL_SERVER_ERROR"

  examples:
    DrinkingEvent:
      summary: é£²ã¿ã‚¤ãƒ™ãƒ³ãƒˆ
      value:
        category: drinking
        date_start: "2025-11-15T19:00:00+09:00"
        date_end: "2025-11-15T22:00:00+09:00"
        capacity_min: 3
        capacity_max: 5
        price_min: 3000
        price_max: 5000
        comment: "ä»•äº‹çµ‚ã‚ã‚Šã«è»½ãä¸€æ¯ã©ã†ã§ã™ã‹?"

    TravelEvent:
      summary: æ—…è¡Œã‚¤ãƒ™ãƒ³ãƒˆ
      value:
        category: travel
        date_start: "2025-12-01T09:00:00+09:00"
        date_end: "2025-12-03T18:00:00+09:00"
        capacity_min: 4
        capacity_max: 8
        price_min: 20000
        price_max: 30000
        deadline: "2025-11-25T23:59:59+09:00"
        comment: "æ¸©æ³‰æ—…è¡Œã«è¡Œãã¾ã›ã‚“ã‹?"

# ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§

## æˆåŠŸã‚³ãƒ¼ãƒ‰ (2xx)
- `EVENT_CREATED`: ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæˆåŠŸ
- `TIMELINE_FETCHED`: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å–å¾—æˆåŠŸ
- `EVENT_FETCHED`: ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°å–å¾—æˆåŠŸ
- `EVENT_UPDATED`: ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†æˆåŠŸ
- `EVENT_CANCELLED`: ã‚¤ãƒ™ãƒ³ãƒˆä¸­æ­¢æˆåŠŸ

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ (4xx)
- `VALIDATION_ERROR`: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆå¿…é ˆé …ç›®æœªå…¥åŠ›ã€æ—¥æ™‚ã®å‰å¾Œé–¢ä¿‚ã‚¨ãƒ©ãƒ¼ç­‰ï¼‰
- `DAILY_LIMIT_EXCEEDED`: 1æ—¥ã®æŠ•ç¨¿ä¸Šé™ã‚¨ãƒ©ãƒ¼ï¼ˆ3ä»¶ï¼‰
- `UNAUTHORIZED`: èªè¨¼ã‚¨ãƒ©ãƒ¼ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æœªæä¾›ã¾ãŸã¯ç„¡åŠ¹ï¼‰
- `FORBIDDEN`: æ¨©é™ã‚¨ãƒ©ãƒ¼ï¼ˆç·¨é›†æ¨©é™ãªã—ã€å‚åŠ è€…æ‰¿èªæ¸ˆã¿ç­‰ï¼‰
- `EVENT_NOT_FOUND`: ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„

## ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ (5xx)
- `INTERNAL_SERVER_ERROR`: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
- `DATABASE_ERROR`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
- `NETWORK_ERROR`: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼

# å®Ÿè£…ãƒãƒ¼ãƒˆ

## Server Actions vs API Routes

ã“ã®APIä»•æ§˜ã¯OpenAPIå½¢å¼ã§è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ãŒã€Next.js 15ã§ã¯Server Actionsã‚’æ¨å¥¨ã—ã¾ã™ã€‚

**Server Actionså®Ÿè£…ä¾‹**:

```typescript
// app/actions/createEvent.ts
'use server';

import { eventSchema } from '@/lib/validations/event';
import { createClient } from '@/lib/supabase/server';
import { generateAnonId } from '@/lib/utils/generateAnonId';

export async function createEvent(formData: FormData) {
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const result = eventSchema.safeParse(Object.fromEntries(formData));
  if (!result.success) {
    return {
      success: false,
      message: result.error.errors[0].message,
      code: 'VALIDATION_ERROR',
    };
  }

  // 1æ—¥ã®æŠ•ç¨¿ä¸Šé™ãƒã‚§ãƒƒã‚¯
  const supabase = createClient();
  const { count } = await supabase
    .from('events')
    .select('id', { count: 'exact', head: true })
    .eq('host_id', userId)
    .eq('category', result.data.category)
    .gte('created_at', new Date().toISOString().split('T')[0]);

  if (count >= 3) {
    return {
      success: false,
      message: '1æ—¥ã®æŠ•ç¨¿ä¸Šé™ï¼ˆ3ä»¶ï¼‰ã«é”ã—ã¾ã—ãŸ',
      code: 'DAILY_LIMIT_EXCEEDED',
    };
  }

  // åŒ¿åIDç”Ÿæˆ
  const anonId = generateAnonId(result.data.category, count);

  // ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
  const { data, error } = await supabase
    .from('events')
    .insert({
      ...result.data,
      anon_id: anonId,
      host_id: userId,
    })
    .select()
    .single();

  if (error) {
    return {
      success: false,
      message: 'ã‚¤ãƒ™ãƒ³ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ',
      code: 'INTERNAL_SERVER_ERROR',
    };
  }

  return {
    success: true,
    message: 'ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ•ç¨¿ã—ã¾ã—ãŸ',
    code: 'EVENT_CREATED',
    data,
  };
}
```

## Supabase RLSã«ã‚ˆã‚‹è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å–å¾—æ™‚ã€ã¤ãªãŒã‚Šãƒªã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¯RLSãƒãƒªã‚·ãƒ¼ã§è‡ªå‹•çš„ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰å´ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```typescript
// ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å–å¾—ï¼ˆRLSãƒãƒªã‚·ãƒ¼ãŒè‡ªå‹•é©ç”¨ï¼‰
const { data, error } = await supabase
  .from('events')
  .select('*')
  .eq('status', 'recruiting')
  .order('created_at', { ascending: false })
  .range(0, 19);
```

## æ—¥æœ¬èªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ—¥æœ¬èªã§è¨˜è¿°ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦æ˜ç¢ºã§å®Ÿè¡Œå¯èƒ½ãªå†…å®¹ã«ã—ã¾ã™ï¼ˆspec.md FR-016ï¼‰ã€‚
