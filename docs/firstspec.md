# 🍶 ゆるぼ（YURUBO） — 詳細仕様（Full ver. 2.0）

---

## 0️⃣ 概要

人間関係の「誘う・断る」摩擦をゼロにする“ゆるぼ（YURUBO）”。
匿名投稿と AI 補助によって、偶発的な社交を自然発生させる。

> SNS が「見る関係」を作ったなら、ゆるぼは「動く関係」を作る。

---

## 1️⃣ ユーザー構造と基本思想

| 立場      | 主な行動                       | 心理的摩擦                 | 解消設計                    |
| --------- | ------------------------------ | -------------------------- | --------------------------- |
| 👑 幹事   | イベント作成／承認／予約／精算 | 決める責任・連絡負担       | AI 補助＋段階的 UI で小分け |
| 🙋‍♂️ 参加者 | 投稿閲覧／参加希望／支払い     | 誘われ方・断り方・情報不足 | 匿名化＋承認段階開示        |
| 🤖 AI     | 候補・提案・支援               | 干渉過多・誤誘導           | 補助止まり・最終判断は人間  |

---

## 2️⃣ 時系列フェーズ仕様

### 🔥 Phase 0：マジックインビテーション（新規・最重要）

**目的**
アプリ未登録の友人を、**「認証・つながり構築・イベント参加」の3ステップを一撃で完了**させることで、初期の過疎状態を防ぎ、自然に巻き込む。

**UXフロー**
1.  **幹事のアクション**
    * イベント作成時、または作成後に「LINEで招待」ボタンを押下。
    * **招待URL生成**: `yurubo.app/i/join?h={host_id}&cat=drinking&evt={event_id}`
    * パラメータに「招待者」「カテゴリ（飲み）」「対象イベント」を埋め込む。

2.  **友人（未登録・ゲスト）のアクション**
    * URLをタップ → ブラウザで**「イベント概要カード」**が開く（アプリDL不要のWebビュー）。
    * 表示内容：「Aさんが今夜の飲み会に誘っています。📍新宿 🕒19:00〜」
    * **「参加する」ボタン**を押下。

3.  **オンボーディングのショートカット**
    * Auth認証（LINE / Google / Apple / One-Tap）。
    * **認証完了と同時にバックグラウンドで以下を自動実行**:
        * ✅ ユーザーアカウント作成
        * ✅ 幹事(Aさん)との間に「飲み友達」フラグをONにしてつながり成立
        * ✅ 該当イベントへの「参加リクエスト」完了
    * **完了画面**: 「参加リクエストを送りました！アプリで承認通知を受け取ってください」と表示しストアへ誘導。

---

### フェーズ 1：投稿（誘い作成）

**目的**
誰でも心理的抵抗なく「軽く誘う」ことができる状態を作る。

**利用対象（マッチ範囲）**

- 投稿は**ユーザーの「つながりリスト」内**のみに配信。
- 「つながりリスト」はユーザーごとに**アクティビティ単位（飲み／旅行／スポーツ等）**で設定。
  例：A さんとは「飲み OK・旅行 NG」など。
- 投稿時、システムがリスト内で**該当カテゴリが OK な人だけ**へ配信。
- したがって、全投稿は“知り合いの中でアクティビティ的に繋がれる人”に限定。

**UI 構成**

- ホーム右下「＋投稿」ボタンでモーダル起動。
- 入力項目：

  - カテゴリ（飲み／旅行／テニス等）
  - 開催日時（開始・終了）
  - 受付締切日時（任意）
  - 想定人数（例：2〜6）
  - 価格帯・短文コメント

- 投稿主は匿名。投稿後に自動で仮幹事化。
- 投稿後は即時タイムラインに反映。

**補足仕様**

- 同カテゴリ投稿は最大 3 件／日。
- 投稿主本人も参加希望ボタンを押さない限り確定しない（自由参加型）。

---

### フェーズ 2：参加・承認

**目的**
承認・拒否・未反応を自然に処理して摩擦を減らす。

**ロジック**

- 各投稿カードの「参加したい」ボタンを押下で仮エントリー登録。
- 最初にエントリーした人が幹事として昇格。
- 幹事ビューでは：

  - 承認／拒否／保留
  - 募集打ち切り／再開

- 無反応（24 時間）→ 自動拒否、幹事にのみログ表示。

**詳細挙動**

- 幹事は承認後に確定通知を送信。
- 拒否されたユーザーには通知されない（心理的配慮）。
- 承認済ユーザーのみチャットルーム開放。
- 参加者は当日分のイベントを一括キャンセル可能。
- **時間単位の被り検知**：同一時間帯に別イベント承認済の場合、参加希望ボタン押下時に警告表示。

**UX 配慮**

- 当日開催イベントでは“自動拒否”を強化：未承認ユーザーを 15 分前にリストから除外。
- 幹事がキャンセルした場合、自動的に次順位に権限移譲。

---

### フェーズ 3：店選定（コスト・実利重視）

**目的**
AIコストを抑えつつ、実用的でハズレのない店を選ぶ。幹事の操作を最小化し、予約失敗や候補迷いを防ぐ。

**ロジック変更**
1.  **検索（Data Source）**:
    * **Google Places API** を利用し、最新の営業状況と評価を取得。
2.  **推論・選定（Intelligence）**:
    * **DeepSeek V3 (via API)** を採用。
    * **セキュリティ配慮**: プロンプトには「エリア、予算、ジャンル、店名」などの**公開情報（Non-PII）のみ**を渡す。ユーザーIDや個人情報は一切送信しない。
    * コスト：GPT-4o比で大幅な圧縮を実現。
3.  **UI**:
    * AI推奨3件 ＋ スキップ（あとで決める）。

**候補生成ルール**

- AI が以下を考慮して 3 件抽出：

  - 参加者の出発地平均点
  - 営業中かつ該当時間帯にネット予約可能な店舗のみ
  - 距離・評価・価格帯のスコア統合

- 候補はカテゴリ別キャッシュを保持（再生成は 30 秒クールタイム）。

**モーダル構成**

- 上部：食べログ店舗ページ埋め込み（scroll 可）
- 下部：予約確認 UI

  - 予約開始時刻（初期値＝イベント時刻）
  - ✅ 店を確定
  - ❌ 埋まってた
  - ⏭ スキップ

**操作パターン**

| 操作          | 結果                                   |
| ------------- | -------------------------------------- |
| ✅ 確定       | store_confirmed=true／チャット通知発火 |
| ❌ 埋まってた | 該当店舗除外 →AI が新店舗補充 → 再表示 |
| ⏭ スキップ    | 店未確定状態のままチャットへ遷移       |

**補足**

- 幹事が手動で予約した場合は、チャットから「店編集モーダル」で URL 貼付＋自動展開。
- **外部タブ比較機能**：複数候補店舗を比較したい場合、外部タブで同時に開ける設計。戻るとモーダルが復元され、再確認 UI に続く。

---

### フェーズ 4：開催・チャット

**目的**
当日までの連絡を簡潔に保ち、匿名性と安心を両立。

**構造**

- 承認者のみチャット入室。
- 表示名は匿名 ID（🍶A 等）。
- 店確定後：

  - ヘッダーに開催日時／幹事名／店名（最寄駅）固定表示。
  - 店名タップ → 住所・URL 展開（OGP プレビュー＋地図リンク）。

- 幹事のみ「店情報編集」ボタンあり。

**特殊処理**

- 開催 10 分前に幹事名を自動開示。
- 未確定時は「店未確定」タグ表示。
- 幹事は開催後でも編集可。

**通知制御**

- 集合時間の 30 分前・10 分前にリマインド通知。
- 当日遅延や集合地点更新が発生した場合、AI がチャットに補足投稿。

**行動例**

- 当日集合連絡や遅刻報告もチャット上で簡潔に行える。AI がリマインド補助投稿を生成。

---

### フェーズ 5：精算（信頼性重視）

**目的**
金銭処理の公平性を担保し、計算ミスをゼロにする。

**ロジック（Code Implementation）**
* ❌ AIによる計算は行わない（ハルシネーション回避）。
* ✅ **IDE側（TypeScript）でのアルゴリズム実装**。
    1.  全員の支払額を入力（0円も可）。
    2.  幹事が傾斜（先輩多め等）を設定。
    3.  **「最小送金回数アルゴリズム」**を実行し、誰が誰にいくら送るべきかのタスクリストを生成。

**手順**

1. 開催翌日、自動で「支払い登録をお願いします」通知。
2. 各参加者が支払い額（0 円も可）とメモを登録。
3. 全員登録完了で幹事へ通知。
4. 幹事が傾斜設定（例：後輩 0.5 倍など）を指定し確定。
5. 支払いタスク生成 → 各自に金額・相手情報通知。
6. 全タスク完了 → 自動アーカイブ化。

**UI 要素**

- 精算タブ内：

  - 支払い入力リスト（全員分）
  - 傾斜設定モーダル（幹事専用）
  - 進捗バー＋未完者リスト（幹事のみ）

**UX 補足**

- 精算対象外（参加費免除）も設定可。
- 幹事が途中で設定を修正可能（未完時のみ）。
- **リマインド条件**：未完者がいる場合、24 時間ごとに最大 3 回再通知。幹事は個別リマインド送信も可能。
- 支払いエラー報告時は幹事に再確認通知。

---

### フェーズ 6：終了・アーカイブ

**目的**
完了後の整理・再利用を容易に。

**仕様**

- 全支払い完了で自動アーカイブ。
- チャット上に「完了済」タグ。
- アーカイブ一覧に過去イベント履歴。
- 幹事は再投稿ボタンで条件コピー可能。
- 検索・絞り込み：カテゴリ／開催月／メンバーで検索可。

---

## 3️⃣ 横断設計ポリシー

### A. 幹事負担軽減

| 項目         | 解消設計                        |
| ------------ | ------------------------------- |
| 候補探し     | AI レコメンド＋バックアップ生成 |
| メンバー管理 | 自動拒否＋優先昇格ルール        |
| 店予約責任   | 予約確認 UI で明示確認          |
| 通知疲れ     | 1h1 件・1 日 3 件制限           |
| 精算管理     | タスク自動生成＋進捗モニタ      |

---

### B. 参加者 UX 摩擦対策

| 摩擦           | 解消設計                                  |
| -------------- | ----------------------------------------- |
| 誰が来るか不安 | 承認後のみ開示＋匿名維持                  |
| 確定が遅い     | 幹事まとめ承認可＋ AI 催促リマインド      |
| キャンセル忘れ | 当日キャンセルボタン＋自動拒否            |
| 集合混乱       | 幹事名＋予約店常時表示＋地図リンク        |
| 情報追従       | AI が最新概要を再掲（店変更・時間更新時） |

---

### C. 通知ポリシー

| タイミング | 内容                   | 対象             |
| ---------- | ---------------------- | ---------------- |
| 投稿時     | 新規イベント通知       | 設定 ON ユーザー |
| 承認時     | 参加確定通知           | 該当者           |
| 店確定     | 店名・時刻・最寄駅     | 全員             |
| 精算開始   | 支払い登録依頼         | 全員             |
| 支払い完了 | 完了報告               | 幹事             |
| 制限       | 1 時間 1 件・1 日 3 件 | 全通知共通       |

---

### D. 匿名設計と開示タイミング

| 要素           | 内容                             |
| -------------- | -------------------------------- |
| 投稿主         | 常時非表示                       |
| 参加希望者     | 幹事のみ閲覧可                   |
| チャット内表示 | 匿名 ID（🍶A など）              |
| 幹事名         | 開催 10 分前自動開示 or 手動開示 |
| 開催後         | 全参加者開示（履歴表示）         |

---

### E. 特殊ケース処理

| ケース         | 対応                              |
| -------------- | --------------------------------- |
| 幹事辞退       | 次順位に自動権限移譲              |
| 店埋まり連続   | AI が別エリア提案                 |
| 当日中止       | 幹事操作 → 全員通知＋精算スキップ |
| 旅行等事前締切 | 受付締切日時で自動打ち切り        |
| 途中追加参加   | 幹事承認 → チャット自動参加       |
| イベント重複   | 同時刻参加制限アラート表示        |

---

## 4️⃣ モバイル UI 構成概要

| 画面           | 概要                                   |
| -------------- | -------------------------------------- |
| ホーム         | 匿名タイムライン＋右下投稿ボタン       |
| 投稿モーダル   | カテゴリ・日付・人数・価格帯・コメント |
| マイイベント   | 幹事 👑／参加中リスト                  |
| 募集管理ビュー | 承認・再開・店選定                     |
| 店候補モーダル | AI 候補 3 件＋スキップ                 |
| 店詳細モーダル | 上：埋め込み／下：予約確認             |
| チャットルーム | 店情報＋メッセージ＋精算タブ           |
| 店編集モーダル | URL 貼付 →OGP 展開＋時刻入力           |
| 精算タブ       | 支払い・傾斜設定・進捗表示＋リマインド |
| 完了画面       | 履歴・再投稿ボタン＋検索機能           |
| 設定画面       | 通知・プロフィール・送金情報           |

---

## 5️⃣ ビジョン

> **AI が段取りを整え、人が決める。**
> 軽い誘いと偶発的な出会いを社会の基盤にする。
> 「誘う・決める・支払う」を楽にし、関係の質を再設計する。

---

**version:** 2.0 (Full UX Spec)
**authors:** お前さん × GPT-5
**date:** 2025-11-11
